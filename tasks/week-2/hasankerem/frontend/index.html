<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Web App</title>
  </head>
  <body>
    <h1>Frontend</h1>
    <h2>Messages from Backend</h2>
    <ul id="messages">
      <!-- Messages will be loaded here -->
    </ul>

    <h2>Add a New Message</h2>
    <form id="messageForm">
      <input
        type="text"
        id="newMessage"
        placeholder="Enter a new message"
        required
      />
      <button type="submit">Add Message</button>
    </form>

    <template id="delete-button-template">
      <button class="delete-button">Delete</button>
    </template>

    <script>
      const backendUrl = "http://192.168.0.59:30080/backend/api/messages";
      console.log(backendUrl);
      // Function to load and display messages
      function loadMessages() {
        fetch(backendUrl)
          .then((response) => response.json())
          .then((data) => {
            const messagesList = document.getElementById("messages");
            messagesList.innerHTML = ""; // Clear existing messages
            data.forEach((message) => {
              const li = document.createElement("li");
              li.textContent = message.text;

              // Create and attach the delete button component
              const deleteButton = createDeleteButton(message.id);
              li.appendChild(deleteButton);

              messagesList.appendChild(li);
            });
          })
          .catch((error) => {
            console.error("Error loading messages:", error);
          });
      }

      // Function to handle form submission and add a new message
      document
        .getElementById("messageForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const newMessageText = document.getElementById("newMessage").value;
          fetch(backendUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: newMessageText }),
          })
            .then((response) => response.json())
            .then(() => {
              loadMessages(); // Reload messages after adding a new one
              document.getElementById("newMessage").value = ""; // Clear the input field
            })
            .catch((error) => {
              console.error("Error adding message:", error);
            });
        });

      // Function to create the delete button component
      function createDeleteButton(id) {
        const template = document.getElementById("delete-button-template");
        const button = template.content.cloneNode(true).querySelector("button");
        button.onclick = () => deleteMessage(id);
        return button;
      }

      // Function to delete a message by ID
      function deleteMessage(id) {
        fetch(`${backendUrl}/${id}`, {
          method: "DELETE",
        })
          .then(() => {
            loadMessages(); // Reload messages after deleting
          })
          .catch((error) => {
            console.error("Error deleting message:", error);
          });
      }

      // Load messages on page load
      loadMessages();
    </script>
  </body>
</html>
